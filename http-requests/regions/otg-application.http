### УВР v2 Regions System - HTTP Tests for otg-application endpoint
### Test environment variables (adjust as needed)
@baseUrl = https://btbmqvawpokfwptcrmem.supabase.co/functions/v1
@prodUrl = https://btbmqvawpokfwptcrmem.supabase.co/functions/v1
@authToken = Bearer admin-jwt-token-here
@userToken = Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ0Ym1xdmF3cG9rZndwdGNybWVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg4NzUwODksImV4cCI6MjA2NDQ1MTA4OX0.8izmlGlzinrsCUHMyH_WpFEfeTCp3t1yfHYDcnmhDws

### Submit OTG application with full data
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "Бориспільська ОТГ",
  "settlements": [
    {
      "name": "Бориспіль",
      "type": "місто"
    },
    {
      "name": "Великі Димери",
      "type": "село"
    },
    {
      "name": "Мала Олександрівка",
      "type": "село"
    }
  ],
  "contacts": {
    "phone": "+380674567890",
    "email": "info@boryspil-otg.gov.ua",
    "address": "вул. Київський Шлях, 2, м. Бориспіль, 08300"
  },
  "leadership": {
    "head_name": "Іванов Іван Іванович",
    "deputy_name": "Петренко Петро Петрович",
    "contact_person": "Сидоренко Сергій Сергійович"
  },
  "document_url": "https://storage.supabase.co/otg-documents/user123/charter.pdf"
}

###

### Submit OTG application without optional fields
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kharkiv_region",
  "name": "Дергачівська ОТГ",
  "settlements": [
    {
      "name": "Дергачі",
      "type": "місто"
    },
    {
      "name": "Пісочин",
      "type": "селище"
    }
  ],
  "contacts": {
    "phone": "+380503456789",
    "email": "contact@dergachi-otg.gov.ua",
    "address": "вул. Центральна, 1, м. Дергачі, 62300"
  },
  "leadership": {
    "head_name": "Коваленко Олександр Миколайович",
    "contact_person": "Шевченко Марія Олександрівна"
  }
}

###

### Test missing authorization header
POST {{baseUrl}}/otg-application
Content-Type: application/json

{
  "region_id": "kyiv_region",
  "name": "Test OTG",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test missing region_id
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "name": "Test OTG",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test invalid name (too short)
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "AB",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test empty settlements array
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "Test OTG",
  "settlements": [],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test invalid settlement structure
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "Test OTG",
  "settlements": [{"name": "Test"}],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test invalid email format
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "Test OTG",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "+380501234567",
    "email": "invalid-email",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test invalid phone format
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "Test OTG",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "123456789",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test missing contacts fields
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "Test OTG",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "+380501234567"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test missing leadership fields
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "kyiv_region",
  "name": "Test OTG",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head"
  }
}

###

### Test invalid region_id
POST {{baseUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "invalid_region",
  "name": "Test OTG",
  "settlements": [{"name": "Test", "type": "село"}],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Test address"
  },
  "leadership": {
    "head_name": "Test Head",
    "contact_person": "Test Contact"
  }
}

###

### Test CORS preflight
OPTIONS {{baseUrl}}/otg-application
Origin: http://localhost:3000
Access-Control-Request-Method: POST
Access-Control-Request-Headers: content-type,authorization

###

### Test invalid method
GET {{baseUrl}}/otg-application
Authorization: {{authToken}}

###

### Production test - submit OTG application
POST {{prodUrl}}/otg-application
Content-Type: application/json
Authorization: {{authToken}}

{
  "region_id": "test_region",
  "name": "Тестова ОТГ",
  "settlements": [
    {
      "name": "Тестове",
      "type": "село"
    }
  ],
  "contacts": {
    "phone": "+380501234567",
    "email": "test@example.com",
    "address": "Тестова адреса 1"
  },
  "leadership": {
    "head_name": "Тестовий Голова",
    "contact_person": "Контактна Особа"
  }
}