# Система автоматизації УВР

## Загальний опис

Система автоматизації Українського Військового Руху (УВР) забезпечує автоматичне виконання рутинних операцій, відправку сповіщень та керування чергами. Система розроблена з урахуванням специфіки роботи з військовослужбовцями та їх сім'ями.

## Компоненти системи

### 1. Система сповіщень

#### Типи сповіщень
- Зміна статусу заявки
- Верифікація профілю
- Зміна категорії
- Системні повідомлення

#### Канали сповіщень
- Внутрішні сповіщення в системі
- Email-повідомлення
- Майбутні канали (SMS, Telegram)

#### Управління сповіщеннями
- Автоматичне створення
- Налаштування користувачем
- Архівація старих сповіщень
- Очищення прочитаних

### 2. Управління чергами

#### Функціонал черг
- Автоматичне сортування за пріоритетом
- Пересування в черзі
- Оновлення позицій
- Сповіщення про зміни

#### Особливості
- Підтримка пріоритетів
- Врахування дати подання
- Автоматичне оновлення
- Історія змін

### 3. Автоматизація процесів

#### Тригери системи
1. **Заявки на проекти**
   - Оновлення лічильників учасників
   - Відправка сповіщень
   - Зміна статусів

2. **Верифікація користувачів**
   - Сповіщення про результат
   - Оновлення статусу
   - Відправка email

3. **Зміна категорії**
   - Обробка запитів
   - Сповіщення користувача
   - Оновлення профілю

### 4. Аудит та статистика

#### Функції аудиту
- Логування змін
- Відстеження дій
- Збереження історії
- Статистичні звіти

#### Статистичні дані
- Загальна кількість користувачів
- Верифіковані користувачі
- Активні проекти
- Заявки в обробці
- Розподіл за категоріями

## Технічні деталі

### 1. Таблиця сповіщень (notifications)

```sql
- id: UUID (PK)
- user_id: UUID (FK)
- type: notification_type
- title: TEXT
- message: TEXT
- action_url: TEXT
- status: notification_status
- metadata: JSONB
```

### 2. Основні функції

#### Сповіщення
- `create_notification()` - створення сповіщення
- `send_email_notification()` - відправка email
- `cleanup_old_notifications()` - очищення старих

#### Черги
- `recalculate_queue_positions()` - перерахунок позицій
- `advance_queue()` - просування в черзі

#### Статистика
- `get_uvr_statistics()` - загальна статистика
- `get_unread_notifications_count()` - непрочитані сповіщення

### 3. Тригери

#### Автоматичні тригери
- `trigger_update_project_participants`
- `trigger_application_notifications`
- `trigger_profile_notifications`
- `trigger_category_request_notifications`

## Налаштування системи

### 1. Планувальник завдань

```sql
-- Очищення старих сповіщень (щоночі о 2:00)
SELECT cron.schedule(
  'cleanup-notifications',
  '0 2 * * *',
  'SELECT public.cleanup_old_notifications();'
);
```

### 2. Індекси для продуктивності

```sql
- idx_notifications_user_status
- idx_notifications_type
- idx_audit_log_created_at
- idx_audit_log_user_action
```

## Безпека та обмеження

### 1. Row Level Security (RLS)
- Користувачі бачать тільки свої сповіщення
- Система може створювати сповіщення
- Адміністратори мають повний доступ

### 2. Обмеження даних
- Максимальний розмір повідомлень
- Термін зберігання сповіщень
- Ліміти на email-розсилки

## Рекомендації з використання

### 1. Для розробників
- Використовувати готові функції
- Дотримуватися форматів даних
- Перевіряти права доступу
- Логувати важливі дії

### 2. Для адміністраторів
- Регулярно перевіряти статистику
- Моніторити черги
- Налаштовувати очищення даних
- Перевіряти журнали аудиту

## Розвиток системи

### Плановані покращення
1. Інтеграція з месенджерами
2. Розширена аналітика
3. Автоматична модерація
4. Покращення продуктивності

### Моніторинг та оптимізація
1. Відстеження навантаження
2. Оптимізація запитів
3. Масштабування системи
4. Резервне копіювання 